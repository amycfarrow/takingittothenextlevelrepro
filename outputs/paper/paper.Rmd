---
title: "The inefficacy of superficial similarities for establishing instructor-student relationships"
author: "Amy Farrow"
date: "April 9th, 2021"
header-includes:
  \usepackage{dcolumn}
  \usepackage{rotating}
output:
  bookdown::pdf_document2:
    toc: yes
subtitle: "Reproducing ‘Taking It to the Next Level’"
abstract: "This paper reproduces the 2019 paper 'Taking It to the Next Level', which evaluates an intervention to improve instructor-student relationship. The modeling results indicate that the intervention, consisting of informing instructors and students about commonalities, has a weak positive effect on student perceptions of instructor-student similarity, but no effect on student perceptions of instructor-student relationship, instructor perception of similarity or instructor-student relationship, grades, or re-enrollment. While the scalability and affordability of the intervention are desirable, there are no results in any of the targeted measures: those that affect and reflect college retention. These results are consistent with the original paper. \\par \\textbf{Keywords:} instructor-student relationship, college, reproduction study"
thanks: 'Code and data are available at: [github.com/amycfarrow/takingittothenextlevelrepro](https://github.com/amycfarrow/takingittothenextlevelrepro).'
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(bookdown)    # for cross referencing figures and graphs; referencing
library(kableExtra)  # for nicer tables
library(here) # for working in an RProject
library(Hmisc) # for correlation matrix
library(readstata13) # for stata files
library(finalfit) # for summary table
library(stargazer) # for model table
library(MASS) # for ordinal logistic model

# NOTE: script 01_ must have been run already

# functions from https://stefaneng.github.io/apa_correlation_table/

apply_if <- function(mat, p, f) {
  # Fill NA with FALSE
  p[is.na(p)] <- FALSE
  mat[p] <- f(mat[p])
  mat
}

apaCorr <- function(mat, corrtype = "pearson") {
  matCorr <- mat
  if (class(matCorr) != "rcorr") {
    matCorr <- rcorr(mat, type = corrtype)
  }

  # Add one star for each p < 0.05, 0.01, 0.001
  stars <- apply_if(round(matCorr$r, 2), matCorr$P < 0.05, function(x) paste0(x, "*"))
  stars <- apply_if(stars, matCorr$P < 0.01, function(x) paste0(x, "*"))
  stars <- apply_if(stars, matCorr$P < 0.001, function(x) paste0(x, "*"))
  # Put - on diagonal and blank on upper diagonal
  stars[upper.tri(stars, diag = T)] <- "-"
  stars[upper.tri(stars, diag = F)] <- ""
  n <- length(stars[1,])
  #colnames(stars) <- 1:n
  # Remove _ and convert to title case
  #row.names(stars) <- tools::toTitleCase(sapply(row.names(stars), gsub, pattern="_", replacement = " "))
  # Add index number to row names
  #row.names(stars) <- paste(paste0(1:n,"."), row.names(stars))
  stars
}
```

# Introduction

College is perceived to be a meritocratic tool for social mobility and career success [@college]. Unfortunately, retention is a large problem in contemporary American colleges, and many students begin degrees without completing them; six-year completion rates for full-time first-time students range from 51% to 86%, depending on school [@finishline]. Even when controlling for pre-college test scores and initial enrollments, completion rate disparities exist based on parental education, socio-economic status, and race/ethnicity [@finishline]. Disparities in college completion lead to further entrenchment of long-standing inequalities [@finishline]. Thus, measures to help students persist in college completion are desirable to reduce wasted resources, and to increase societal equity.

Many interventions to increase completion rates have been suggested and tested. For example, @citecasemanagement studied case managment techniques; @citerecruiting investigated the effect of high school recruitment; @citenearbies identify the importance of interpersonal relationships; @citecertificate argue that certificates awarded prior to degrees can ameliorate the 'college-completion crisis'. These are only a small sample of the interventions suggested. Implementing an effective program is difficult due to complicated causes of attrition, embedded social inequalities, and expenses.

@citeoriginal's paper, "Taking It to the Next Level: A Field Experiment to Improve Instructor-Student Relationships in College", tests one intervention. In this field experiment, they tested the effect of instructor-student similarity on instructor-student relationships and measures of student success. Based on extensive K-12 research about the importance of instructor-student relationship for student success, @citeoriginal aimed to establish how instructor-student relationships could be improved at the college level, and to test if this improvement had a positive result.

This paper reproduces @citeoriginal's original study, using anonymized data provided by the authors. Linear, logistic, and ordinal logistic models are used to predict outcomes including perceived ISR, grade, and re-enrollment. These models show that treatment slightly improves student perception of instructor-student similarity, but does not significantly affect student or instructor ISR perception, grade, exam grade, or future enrollment. In addition to the models in the original paper, this paper explores models using different controls and models that consider specific subgroups of the study participants.

# Methods

@citeoriginal conducted a randomized controlled trial to assess the impact of awareness of instructor-student similarities on perceived similarity, instructor-student relationship, course grade, and re-enrollment.

## Participants

The study took place in the 2017 spring semester at a large Californian University. The study included 120 instructors and their 2,749 students. The instructors participated in the study based on interest and a gift-card incentive, and their students were invited to participate unincentivized.Students were only enrolled in the study for one class, in the event that they were taking classes with multiple participating instructors.

## Treatment and control

Participating students were randomly assigned to either treatment or control. At the beginning of the term, all participating students and instructors were given "get to know you" surveys. Using those responses, for each student in the treatment group, seven commonalities were identified between student and instructor (for example, perhaps both student and instructor binge-watch TV to relieve stress, or appreciate loyalty as the most important friend quality), and both student and instructor were informed of these commonalities. They completed a few questions about the similarities and were reminded of them through the semester to ensure they were internalized. Students in the control group were informed about similarities they shared with students in another part of the country, and instructors were told nothing about these students.

## Procedures

All students participated in a survey immediately following the treatment or the placebo. They were surveyed again at the end of the course. Instructors were surveyed only at the end of the course.

## Measures

@citeoriginal identify key measures. Some are extracted from the student survey at the beginning of the term:

* s1_sim: Immediately after the treatment or placebo, students answered six questions about their perceived similarity to the instructor, on scales of 1 to 5. These responses were averaged to create a similarity scale. 
  - Overall, how similar to your instructor's values do you think your values are?
  - How similar are your goals for the course and your instructor's goals?
  - In general, how similar do you think your views about the course content and your instructor's are?
  - How much do you think you have in common with your instructor?
  - How similar do you think your personality is compared to your instructor's?
  - Overall, how similar do you think you and your instructor are?
* s1_tsr: Immediately after the treatment or placebo, students answered seven questions about their perception of the instructor-student relationship, on scales of 1 to 5. These responses were averaged to create an ISR scale.
  - How much do you think you will enjoy learning from this instructor?
  - How friendly do you think this instructor will be towards you?
  - How encouraging do you think this instructor will be towards you?
  - If you came back to visit this instructor three years from now, how excited do you think they would be?
  - How motivating do you think you will find this instructor's class?
  - How caring do you think this instructor will be towards you?
  - Overall, how much do you think you will learn from this instructor?
* s1_female: The student's gender.

Others are extracted from the student survey at the end of the term:

* s2_sim: At the end of the semester, students answered the above six similarity scale questions again.
* s2_tsr: At the end of the semester, students answered the above seven ISR scale questions again.

Others come from the instructor survey at the end of the term:

* t2_sim1: At the end of the semester, instructors answered only one quesiton about similarity with the student, on a scale of 1 to 5.
  - Overall, how similar do you think you and STUDENTNAME are?
* t2_tsr: At the end of the semester, instructors answered seven questions about their perception of the instructor-student relationship, on scales of 1 to 5. These responses were averaged to create an ISR scale.
  - How much did you enjoy helping STUDENTNAME learn?
  - How caring was STUDENTNAME towards you?
  - How often did you say something encouraging to STUDENTNAME?
  - How friendly was STUDENTNAME towards you?
  - If this student came back to visit you three years from now, how excited would you be?
  - How motivating did STUDENTNAME find the activities that you plan for class?
  - Overall, how much did STUDENTNAME learn from you?
* t2_finalexam: Instructors were asked to report the student's grade on their final exam, paper, or project.

Finally, some are extracted from the university's internal records:

* grade: The final grade that the student received in the course.
* std_grade: The student's final grade, standardized against other grades in the course.
* ir_f16_gpa: The student's cumulative GPA after the Fall 2016 term.
* f17_enrolled: The student's status as of Fall term 2017: not enrolled or enrolled.

TODO: evaluate scales' validity

# Data

TODO: add all citations for R packages

```{r, warning=FALSE, message=FALSE, echo=FALSE}
isrdata <- read.dta13(here("inputs/data/Instructor-Student Relationships Experiment Data_Anonymous.dta"))
```

```{r, warning=FALSE, message=FALSE, echo=FALSE}
expdata <- isrdata %>%
  filter(use == 1) %>%
  mutate(across(where(is.numeric), ~na_if(., -99)))
```

Table \@ref(tab:demotable) shows the demographics for the treatment and control samples. There are no significant differences between the treatment and control groups.

However, there are differences between the students and instructors. Notably, the student sample is 60.3% female, while the instructor sample is 78.7% female. The student sample is 21.5% White/Caucasian and 51.5% Hispanic American or Latino/a, while the instructor sample is 67.0% White/Caucasian and 6.0% Hispanic American or Latino/a. 43.1% of the students are first generation university attendees, while only 23.3% of the instructors are.

```{r demotable, echo=FALSE, warning=FALSE, message=FALSE}
expdata %>% 
  dplyr::select(treatment, s1_sim, s_female, t_female, s_race, t_race, s1_age, t_age, s_firstgen, t_firstgen, ir_f16_gpa, ir_t_s17enrltot) %>%
  mutate(s_race = as.factor(s_race), t_race = as.factor(t_race)) %>%
  summary_factorlist("treatment", c("s_female", "t_female", "s_race", "t_race", "s1_age", "t_age", "s_firstgen", "t_firstgen", "ir_f16_gpa", "ir_t_s17enrltot"),
                     p = TRUE, 
                     add_dependent_label = TRUE, 
                     dependent_label_prefix = "",
                     add_col_totals = TRUE,
                     add_row_totals = TRUE,
                     include_row_missing_col = TRUE,
                     col_totals_rowname = "",
                     total_col = TRUE,
                     col_totals_prefix = "N(%) = ") %>%
  rename(N = "Total N", Missing = "Missing N") %>%
  knitr::kable(caption = "Demographics for treatment and control groups",
               booktabs = TRUE, linesep = "") %>%
  kableExtra::kable_styling(latex_options = c("scale_down", "striped"), stripe_index =c(2:3,6:13,20,22:23,26))
```

TODO: graphs showing instructor vs. student demographics. Implications.

Table \@ref(tab:summarytable) shows summary statistics for key variables identified by @citeoriginal, including missing values.

```{r summarytable, echo=FALSE, warning=FALSE, message=FALSE}
expdata %>% 
  dplyr::select(treatment, s1_sim, s1_tsr, s2_sim, s2_tsr, t2_sim1, t2_tsr, grade, std_grade, t2_finalexam, f17_enrolled, s1_female) %>%
  summary_factorlist("treatment", c("s1_sim", "s1_tsr", "s2_sim", "s2_tsr", "t2_sim1", "t2_tsr", "grade", "std_grade", "t2_finalexam", "f17_enrolled", "s1_female"),
                     p = FALSE, 
                     add_dependent_label = TRUE, 
                     dependent_label_prefix = "",
                     add_col_totals = TRUE,
                     add_row_totals = TRUE,
                     include_row_missing_col = TRUE,
                     col_totals_rowname = "",
                     total_col = TRUE,
                     col_totals_prefix = "N(%) = ") %>%
  rename(N = "Total N", Missing = "Missing N") %>%
  knitr::kable(caption = "Descriptive statistics for treatment and control groups",
               booktabs = TRUE, linesep = "") %>%
  kableExtra::kable_styling(latex_options = c("scale_down", "striped"), stripe_index =c(2,4,6,8,10,13:14))
```

# Models

## Reproduction models

$treatment_{i}$ is the indicator that treatment was given.

$X_{1i}$ is a vector of student-level covariates (pre-intervention measures included).

$X_{2j}$ is a vector of instructor-level covariates.

$\epsilon_{ij}$ is a clustered residual.

$\beta_{0}$, $beta_{1}$, $\Gamma_{1}$, $\Gamma_{2}$, and $a_{k}$ are coefficients on the resulting models.

### Linear models

Equation \@ref(eq:linmodel) is @citeoriginal's linear model, used for continuous outcomes, which include complete scale outcomes (immediate student similarity rating (s1_sim), end of semester student similarity rating (s2_sim), end of semester student ISR rating (s2_tsr), and end of semester instructor ISR rating (t2_tsr)) and grade-based outcomes, measured in GPA (course grade (grade) and objectively graded exam grade (t2_finalexam)).

\begin{equation}
(\#eq:linmodel)
Outcome_{ij} = \beta_{0} + \beta_{1}treatment_{i} + X_{1i}\Gamma_{1} + X_{2j}\Gamma_{2} + \epsilon_{ij}
\end{equation}

### Ordinal logistic models

Equation \@ref(eq:ordlogmodel) is @citeoriginal's ordinal logistic model, used for the ordinal outcome, which is end of semester instructor similarity rating (t2_sim1).

\begin{equation}
(\#eq:ordlogmodel)
prob(outcome_{ij}) = a_{k} + \beta_{1}treatment_{i} + X_{1i}\Gamma_{1} + X_{2j}\Gamma_{2} + \epsilon_{ij} > k
\end{equation}

### Logistic models

Equation \@ref(eq:logmodel) is @citeoriginal's logistic model, used for the binary outcome, which is enrollment in Fall term 2017 (f17_enrolled).

\begin{equation}
(\#eq:logmodel)
prob(outcome_{ij}) = a_{k} + \beta_{1}treatment_{i} + X_{1i}\Gamma_{1} + X_{2j}\Gamma_{2} + \epsilon_{ij} > k
\end{equation}

## Additional models

TODO: additional models
Consider:
More covariates: race, class size, first generation
New covariates: instructor-student commonalities (gender, race)
Models looking at subgroups of the sample: Only those with matching traits, only small classes
Focus on grade as the outcome.

# Results

## Reproduction results

Table \@ref(tab:correlationtable) displays a correlation matrix for the measures that @citeoriginal identified as significant. Some measures, unsurprisingly, are highly correlated: grade and standardized grade, and grade and final exam grade. Others are moderately correlated: student initial perceptions of similarity and instructor-student relationship, student end-of-term perceptions of similarity and instructor-student relationship, and instructor end-of-term perceptions of similarity and instructor-student relationship. These last three pairs could indicate that the similarity perception scales and instructor-student relationship perception scales may not be measuring distinct concepts, or that feelings of similarity and positivity in relationships are strongly associated in the classroom.

```{r correlationtable, echo=FALSE, warning=FALSE, message=FALSE}
summary <- expdata %>% 
  dplyr::select(treatment, s1_sim, s1_tsr, s2_sim, s2_tsr, t2_sim1, t2_tsr, grade, std_grade, t2_finalexam, ir_f16_gpa, f17_enrolled, s1_female) %>%
  summary_factorlist("treatment", c("s1_sim", "s1_tsr", "s2_sim", "s2_tsr", "t2_sim1", "t2_tsr", "grade", "std_grade", "t2_finalexam", "ir_f16_gpa"),
                     p = FALSE, 
                     add_dependent_label = TRUE, 
                     dependent_label_prefix = "",
                     add_col_totals = FALSE,
                     add_row_totals = TRUE,
                     include_row_missing_col = TRUE,
                     col_totals_rowname = "",
                     total_col = TRUE,
                     col_totals_prefix = "N (%) = ") %>%
  dplyr::select("Total N", "Missing N", "Total")

matrix <- data.frame(apaCorr(as.matrix(expdata %>% 
                  dplyr::select(s1_sim, s1_tsr, s2_sim, s2_tsr, t2_sim1, t2_tsr, grade, std_grade, t2_finalexam, ir_f16_gpa)))) 
summary %>%
  bind_cols(matrix) %>%
  rename("Mean (SD)" = Total, N = "Total N", Missing = "Missing N") %>%
  kable(caption = "Descriptive statistics and correlation matrix for key continuous variables",
               booktabs = TRUE, linesep = "") %>%
  kable_styling(latex_options = c("scale_down"))
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
studentfirstsimilaritymodel <- lm(data = expdata %>%
                                    filter(!is.na(s1_sim)),
                                  s1_sim ~ treatment)
studentsecondsimilaritymodel <- lm(data = expdata %>% 
                                     filter(!is.na(s2_sim)),
                                   s2_sim ~ treatment)
studentsecondrelationshipmodel <- lm(data = expdata %>%
                                       filter(!is.na(s2_tsr) & !is.na(s1_tsr)),
                                     s2_tsr ~ treatment + s1_tsr)
teachersecondrelationshipmodel <- lm(data = expdata %>%
                                       filter(!is.na(t2_tsr)),
                                     t2_tsr ~ treatment)
grademodel <- lm(data = expdata %>%
                   filter(!is.na(s1_female) & !is.na(ir_f16_gpa) & !is.na(grade) & s1_female > -99),
                 grade ~ treatment + s1_female + ir_f16_gpa)
examgrademodel <- lm(data = expdata %>%
                       filter(obj_exam == 1) %>%
                       filter(!is.na(s1_female) & !is.na(ir_f16_gpa) & !is.na(t2_finalexam) & s1_female > -99),
                     t2_finalexam ~ treatment + s1_female + ir_f16_gpa)
teachersecondsimilarity <- polr(formula = as.factor(t2_sim1) ~ treatment,
                                data = expdata %>%
                                  filter(!is.na(t2_sim1)),
                                Hess = TRUE)
enrollmentfallmodel <- glm(data = expdata %>%
                             mutate(f17_enrolled = as.factor(f17_enrolled)) %>%
                             filter(!is.na(s1_female) & !is.na(ir_f16_gpa) & !is.na(f17_enrolled) & s1_female > -99),
                           f17_enrolled ~ treatment + s1_female + ir_f16_gpa,
                           family = "binomial")
```

```{r modeltable, results='asis', echo=FALSE, warning=FALSE, message=FALSE}
stargazer(studentfirstsimilaritymodel,
          studentsecondsimilaritymodel,
          studentsecondrelationshipmodel,
          teachersecondrelationshipmodel,
          grademodel,
          examgrademodel,
          teachersecondsimilarity,
          enrollmentfallmodel,
          title = "Model results",
          align = TRUE,
          float.env = "sidewaystable",
          no.space = TRUE,
          omit.stat=c("ser","f"),
          column.sep.width = "-10pt",
          label = "tab:modeltable",
          type = "latex",
          header = FALSE)
```

In Table \@ref(tab:modeltable), Model 1 shows a statistically significant relationship between treatment and student initial similarity perception. However, the expected increase is only 0.155 on a scale of 1 to 5. Model 2 shows a statistically significant relationship between treatment and student end-of-semester similarity perception. However, the expected increase is only 0.095 on a scale of 1 to 5.

Model 3 shows no significant relationship between treatment and student end-of-semester ISR perception. However, it does show a significant correlation between anticipated student ISR and student end-of-semester ISR. For every 1 point increase in anticipated ISR on a 1 to 5 scale, the expected increase in end-of-semester ISR is 0.674.

Models 4, 5, 6, 7, and 8 show no significant relationship between treatment and instructor end-of-semester ISR perception, course grade, objectively graded exam grade, instructor perception of similarity at the end of the term, and enrollment in the subsequent semester.

TODO: clustered residuals

## Additional results

TODO: additional results

# Discussion

TODO: discussion
Inefficacy of weak measures in the face of divergent student/instructor demographics and massive class sizes.
Who perceives similarity
What does it mean for relationships and therefore academic success to be built on similarity.

\newpage

# References
